<project name="test">

    <target description="Retrieve test dependencies with Ivy."
    	name="deps-test">
    	
    	<ivy-retrieve conf="test"/>
    </target>


	<target description="Compile test classes."
		name="build-test"
		depends="@before-build-test,build-main,deps-test,@on-build-test" >

		<compile conf="test">
			<additional-classpath>
				<path location="./bin/main/java"/>
				<path location="${build.classpath.main}"/>
				<path location="${build.classpath.test}"/>
			</additional-classpath>
		</compile>
		
		<antcall target="@after-build-test"/>
	</target>
	
	<extension-point name="@before-build-test"/>
	<extension-point name="@on-build-test"/>
	<extension-point name="@after-build-test"/>


	<target description="Executes tests for the project."
		name="test"
		depends="@before-test,build-test,@on-test">
	
		<mkdir dir="./bin/test/result"/>
				
		<junit fork="no" haltonfailure="true">
			<classpath>
				<fileset dir="./lib/test/java" includes="*.jar" />
				<path location="./bin/test/java" />
				<path location="./bin/main/java" />
				<path location="${build.classpath}"/>
				<path location="${build.classpath.main}"/>
				<path location="${build.classpath.test}"/>
			</classpath>
		    <formatter type="plain" usefile="false" /> <!-- to screen -->
		    <formatter type="plain" /> <!-- to file -->
			<batchtest todir="./bin/test/result">
				<!-- Can be used as soon ant 1.9.3 is available on travis -->
				<!--fileset dir="./src/test/java" skipNonTests="true"/-->
				<fileset dir="./src/test/java" includes="**/*Test.java"/>
				<fileset dir="./src/test/java" includes="**/*Suite.java"/>
			</batchtest>
		</junit>
		
		<antcall target="@after-test"/>
	</target>
	
	<extension-point name="@before-test"/>
	<extension-point name="@on-test"/>
	<extension-point name="@after-test"/>

</project>
